// HspppSample/UserApp.cpp
// ═══════════════════════════════════════════════════════════════════
// HSPPP デモ: buffer, gsel, gcopy, gzoom, gmode, bgscr のテスト
// ═══════════════════════════════════════════════════════════════════

import hsppp;
using namespace hsppp;

// ユーザーのエントリーポイント
int hspMain() {

    // ╔═══════════════════════════════════════════════════════════════╗
    // ║  テスト1: buffer命令 - 仮想画面の作成                        ║
    // ╚═══════════════════════════════════════════════════════════════╝

    // buffer 2 で仮想画面を作成（表示されない）
    buffer(2, 200, 200);

    // 仮想画面に描画
    redraw(0);
    color(255, 0, 0);   // 赤
    boxf();             // 全体を塗りつぶし
    
    // グラデーション風に色を追加
    color(0, 255, 0);   // 緑
    boxf(50, 50, 150, 150);
    
    color(0, 0, 255);   // 青
    boxf(75, 75, 125, 125);
    redraw(1);

    // ╔═══════════════════════════════════════════════════════════════╗
    // ║  テスト2: screen命令 - メインウィンドウの作成                ║
    // ╚═══════════════════════════════════════════════════════════════╝

    screen(0, 640, 480, {}, 100, 100, {}, {}, "HSPPP Test - buffer/gcopy/gzoom");

    redraw(0);

    // 背景を薄いグレーで塗りつぶし
    color(200, 200, 200);
    boxf();

    // タイトル
    color(0, 0, 0);
    pos(20, 20);
    mes("=== buffer / gcopy / gzoom Test ===");

    redraw(1);

    // ╔═══════════════════════════════════════════════════════════════╗
    // ║  テスト3: gcopy命令 - 仮想画面からコピー                     ║
    // ╚═══════════════════════════════════════════════════════════════╝

    // gsel でウィンドウ0を描画先に設定
    gsel(0);

    // gmode設定: モード0（通常コピー）、サイズ100x100
    gmode(0, 100, 100);

    redraw(0);
    
    pos(20, 60);
    mes("gcopy from buffer 2:");

    // buffer 2 から gcopy
    pos(20, 80);
    gcopy(2, 0, 0, 100, 100);

    redraw(1);

    // ╔═══════════════════════════════════════════════════════════════╗
    // ║  テスト4: gzoom命令 - 変倍コピー                             ║
    // ╚═══════════════════════════════════════════════════════════════╝

    gsel(0);
    redraw(0);

    pos(150, 60);
    mes("gzoom (2x scale):");

    // buffer 2 から gzoom（2倍に拡大）
    pos(150, 80);
    gzoom(200, 200, 2, 0, 0, 100, 100, 0);

    redraw(1);

    // ╔═══════════════════════════════════════════════════════════════╗
    // ║  テスト5: bgscr命令 - 枠なしウィンドウ                       ║
    // ╚═══════════════════════════════════════════════════════════════╝

    // メインウィンドウにメッセージ表示
    gsel(0);
    redraw(0);
    pos(20, 300);
    color(0, 0, 0);
    mes("bgscr test: Borderless window created (ID=3)");
    mes("Press close button on main window to exit.");
    redraw(1);

    // 枠なしウィンドウを作成
    bgscr(3, 200, 150, 0, 400, 400);

    redraw(0);
    color(50, 50, 100);
    boxf();
    color(255, 255, 255);
    pos(20, 20);
    mes("Borderless Window");
    pos(20, 50);
    mes("(bgscr ID=3)");
    pos(20, 80);
    mes("No frame!");
    redraw(1);

    // ╔═══════════════════════════════════════════════════════════════╗
    // ║  テスト6: gsel命令 - ウィンドウ切り替え                      ║
    // ╚═══════════════════════════════════════════════════════════════╝

    // メインウィンドウに戻る
    gsel(0, 1);  // アクティブにする

    redraw(0);
    pos(20, 350);
    color(0, 128, 0);
    mes("Test completed successfully!");
    mes("All functions: buffer, gsel, gcopy, gzoom, gmode, bgscr");
    redraw(1);

    // ═══════════════════════════════════════════════════════════════
    // 自動終了（デバッグ用）
    // await で少し待ってから end で終了
    // ═══════════════════════════════════════════════════════════════
    
    await(3000);  // 3秒待機
    end(0);       // 正常終了

    return 0;
}
