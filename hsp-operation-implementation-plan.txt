================================
HSP操作リスト - 実装計画
================================

凡例:
  ✓ = 実装済み
  ○ = 実装予定
  △ = 一部実装 / 検討中
  × = 不要（ライブラリの方針外）
  - = 保留

優先度:
  [P1] = 最優先（基幹機能 / GUI確認に必須）
  [P2] = 高優先度（基本機能）
  [P3] = 中優先度（便利機能）
  [P4] = 低優先度（拡張機能）
  [--] = 不要

================================
第1フェーズ: 基幹構造の確立
================================

■ 画面制御命令 [P1]
----------------------------------------
✓ [P1] screen          ウィンドウを初期化
✓ [P1] buffer          仮想画面を初期化
✓ [P1] bgscr           枠のないウィンドウを初期化
✓ [P1] gsel            描画先指定、ウィンドウ最前面、非表示設定
✓ [P1] gmode           画面コピーモード設定
✓ [P1] gcopy           画面コピー
✓ [P1] gzoom           変倍して画面コピー
✓ [P1] redraw          再描画の設定
✓ [P1] color           カラー設定
✓ [P1] pos             カレントポジション設定
✓ [P1] mes             メッセージ表示
✓ [P1] boxf            矩形を塗りつぶす
✓ [P1] line            直線を描画
✓ [P1] circle          円を描画する
✓ [P1] pset            1dotの点を表示
✓ [P1] pget            1dotの点を取得
✓ [P1] cls             画面クリア
✓ [P1] font            フォント設定
✓ [P1] title           タイトルバー設定
✓ [P1] width           ウィンドウサイズ設定

✓ [P2] sysfont         システムフォント選択
✓ [P2] picload         画像ファイルをロード
✓ [P2] celload         画像ファイルをバッファにロード
✓ [P2] celput          画像素材を描画
✓ [P2] celdiv          画像素材の分割サイズを設定
✓ [P2] bmpsave         画面イメージセーブ

✓ [P3] gradf           矩形をグラデーションで塗りつぶす
✓ [P3] grect           回転する矩形で塗りつぶす
✓ [P3] grotate         矩形画像を回転してコピー
✓ [P3] gsquare         任意の四角形を描画
✓ [P3] groll           ウィンドウの描画基点とスケールを設定

× [--] axobj           ActiveXコントロールの配置（COM/ActiveX依存）
× [--] winobj          ウィンドウオブジェクトの配置（Win32 GUI依存）
× [--] chgdisp         画像解像度を変更する（実行時解像度変更は非推奨）

✓ [P2] hsvcolor        HSV形式でカラーを設定する
✓ [P2] rgbcolor        RGB形式でカラーを設定する
× [P2] palcolor        描画パレット設定
× [--] palette         パレット設定（256色モード非対応）
✓ [P2] syscolor        システムカラーを設定する

✓ [P3] print           メッセージ表示（mes互換・改行付き）
✓ [P3] sendmsg         ウィンドウメッセージの送信

✓ [P4] dialog          ダイアログを開く


■ 基本入出力制御命令 [P1]
----------------------------------------
✓ [P1] stick           キー入力情報取得
✓ [P1] getkey          キー入力チェック
✓ [P1] mouse           マウスカーソル座標設定
✓ [P1] randomize       乱数発生の初期化

✓ [P3] setease         イージング関数の計算式を設定
✓ [P3] sortget         ソート元のインデックスを取得
✓ [P3] sortnote        メモリノート文字列をソート
✓ [P3] sortstr         配列変数を文字列でソート
✓ [P3] sortval         配列変数を数値でソート

× [--] mcall           メソッドの呼び出し（COM専用）
× [--] callfunc        外部関数の呼び出し（DLL専用）


■ 基本入出力関数 [P1]
----------------------------------------
△ [P1] ginfo           ウィンドウ情報の取得（一部実装）
✓ [P1] ginfo_r         現在設定されているカラーコードR
✓ [P1] ginfo_g         現在設定されているカラーコードG
✓ [P1] ginfo_b         現在設定されているカラーコードB
✓ [P1] mousex          マウスカーソルのX座標
✓ [P1] mousey          マウスカーソルのY座標
✓ [P1] mousew          マウスカーソルのホイール値

✓ [P1] int             整数値に変換
✓ [P1] double          実数値に変換
✓ [P1] str             文字列に変換
✓ [P1] strlen          文字列の長さを調べる

✓ [P2] abs             整数の絶対値を返す
✓ [P2] absf            実数の絶対値を返す
✓ [P2] sin             サイン値を返す
✓ [P2] cos             コサイン値を返す
✓ [P2] tan             タンジェント値を返す
✓ [P2] atan            アークタンジェント値を返す
✓ [P2] sqrt            ルート値を返す
✓ [P2] powf            累乗（べき乗）を求める
✓ [P2] expf            指数を返す
✓ [P2] logf            対数を返す

✓ [P2] rnd             乱数を発生
✓ [P2] limit           一定範囲内の整数を返す
✓ [P2] limitf          一定範囲内の実数を返す

✓ [P2] M_PI            円周率 (std::numbers::pi)
✓ [P2] M_PI_2          円周率/2
✓ [P2] M_PI_4          円周率/4
✓ [P2] M_1_PI          1/円周率
✓ [P2] M_2_PI          2/円周率
✓ [P2] M_E             自然対数の底 (std::numbers::e)
✓ [P2] M_LOG2E         log2(e) (std::numbers::log2e)
✓ [P2] M_LOG10E        log10(e) (std::numbers::log10e)
✓ [P2] M_LN2           ln(2) (std::numbers::ln2)
✓ [P2] M_LN10          ln(10) (std::numbers::ln10)
✓ [P2] M_SQRT2         √2 (std::numbers::sqrt2)
✓ [P2] M_SQRT1_2       1/√2
✓ [P2] M_SQRT3         √3 (std::numbers::sqrt3)
✓ [P2] M_SQRTPI        √π (std::numbers::inv_sqrtpi)

✓ [P2] gettime         時間・日付を取得する
✓ [P2] sysinfo         システム情報の取得
✓ [P2] dirinfo         ディレクトリ情報の取得

✓ [P3] getease         イージング値を整数で取得
✓ [P3] geteasef        イージング値を実数で取得

× [P3] length          配列の1次元要素数を返す
× [P3] length2         配列の2次元要素数を返す
× [P3] length3         配列の3次元要素数を返す
× [P3] length4         配列の4次元要素数を返す

× [P3] varptr          変数データのポインタを返す（&演算子や.data()を使用）
× [P3] varsize         変数データのバッファサイズを返す（sizeof演算子や.size()を使用）
× [P3] vartype         変数の型を返す（C++の型システム/typeidを使用）
× [P3] varuse          変数の使用状況を返す（RAIIにより自動管理）

× [--] objinfo         ウィンドウオブジェクト情報の取得（GUI部品専用）
× [--] libptr          外部呼出しコマンドの情報アドレスを得る（DLL専用）


■ プログラム制御命令 [P1]
----------------------------------------
✓ [P1] await           一定の時間で待つ
✓ [P1] wait            実行を一定時間中断する
✓ [P1] stop            プログラム中断
✓ [P1] end             プログラム終了

× [P1] if              条件を満たしていればその行の命令を実行（C++）
× [P1] else            条件を満たしていなければその行の命令を実行（C++）
× [P1] goto            指定ラベルにジャンプ（なし）
× [P1] gosub           指定ラベルにサブルーチンジャンプ（なし）
× [P1] return          サブルーチンから復帰（C++）

× [P1] repeat          ループの始まりの場所を示す（C++のfor/whileを使用）
× [P1] loop            ループの始まりに戻る
× [P1] break           ループから抜ける
× [P1] continue        ループをやり直す

× [P2] foreach         変数の要素数だけ繰り返す（C++の範囲for文を使用）
× [P2] on              数値による分岐（switch/ifを使用）
× [P2] exgoto          指定ラベルに条件ジャンプ（if/gotoを使用）

✓ [P3] exec            Windowsのファイルを実行する
× [P3] run             指定したファイルに制御を移す（実現不可）

※ HSPスクリプトではなくC++なので、if/else/for/while/switch等は
  C++標準構文を使用。HSP互換マクロとして提供可能。


■ プログラム制御マクロ [P2]
----------------------------------------
× [P2] do              do繰り返し開始
× [P2] until           do繰り返し終了
× [P2] while           while繰り返し開始
× [P2] wend            while繰り返し終了
× [P2] for             指定回数繰り返し開始
× [P2] next            指定回数繰り返し終了

× [P2] switch          比較ブロック開始
× [P2] case            比較値指定
× [P2] default         デフォルト比較指定
× [P2] swbreak         比較実行脱出指定
× [P2] swend           比較ブロック終了

× [P3] _break          マクロループを脱出する
× [P3] _continue       マクロループをやり直す

※ C++標準構文（for, while, do-while, switch）を使用すべき


================================
第2フェーズ: 割り込み・イベント
================================

■ 割り込み制御命令 [P1]
----------------------------------------
✓ [P1] onclick         クリック割り込み実行指定
✓ [P1] oncmd           Windowsメッセージ割り込み実行指定
✓ [P1] onerror         エラー発生時にジャンプ
✓ [P1] onexit          終了時にジャンプ
✓ [P1] onkey           キー割り込み実行指定

✓ [P1] iparam          割り込み要因を示す値
✓ [P1] wparam          割り込み時のwParam
✓ [P1] lparam          割り込み時のlParam


================================
第3フェーズ: データ管理
================================

■ メモリ管理命令 [P2]
----------------------------------------
× [P2] dim             配列変数を作成（std::vectorを使用）
× [P2] sdim            文字列型配列変数を作成（std::vector<std::string>を使用）
× [P2] ddim            実数型配列変数を作成（std::vector<double>を使用）
× [P2] ldim            ラベル型配列変数を作成（不要）
× [P2] dimtype         指定タイプの配列変数を作成

× [P3] newmod          モジュール型変数の作成（class/structを使用）
× [P3] delmod          モジュール型変数の要素削除
× [P3] newlab          ラベル型変数を初期化
× [P3] alloc           バッファを確保
× [P3] memcpy          メモリブロックのコピー（std::copy/代入推奨。非POD型への使用は危険）
× [P3] memset          メモリブロックのクリア（std::fill/コンストラクタ推奨。非POD型への使用は危険）
× [P3] memexpand       メモリブロックの再確保（std::vector::resize等で自動管理されるため不要）

× [P3] poke            バッファに1byte書き込み（ポインタ/キャスト/構造体を使用）
× [P3] wpoke           バッファに2byte書き込み
× [P3] lpoke           バッファに4byte書き込み

× [--] comres          メソッド返値代入変数を設定する（COM専用）
× [--] dup             クローン変数を作成（C++では参照/ポインタで代替）
× [--] dupptr          ポインタからクローン変数を作成（同上）
× [--] mref            特殊なメモリを変数に割り当てる（内部用）


■ メモリ管理関数 [P3]
----------------------------------------
× [P3] peek            バッファから1byte読み出し（ポインタ/キャスト/構造体を使用）
× [P3] wpeek           バッファから2byte読み出し
× [P3] lpeek           バッファから4byte読み出し


■ ファイル操作命令 [P2]
----------------------------------------
✓ [P2] bload           バッファにファイルをロード
✓ [P2] bsave           バッファをファイルにセーブ
✓ [P2] exist           ファイルのサイズ取得
✓ [P2] delete          ファイル削除 (deletefile関数として実装)
✓ [P2] bcopy           ファイルのコピー
✓ [P2] dirlist         ディレクトリ一覧を取得
✓ [P2] mkdir           ディレクトリ作成
✓ [P2] chdir           ディレクトリ移動

× [--] chdpm           DPMファイル設定（HSP固有機能）
× [--] memfile         メモリストリーム設定（代替手段あり）


■ 文字列操作命令 [P2]
----------------------------------------
✓ [P2] notesel         対象バッファ指定
✓ [P2] noteadd         指定行の追加・変更
✓ [P2] notedel         行の削除
✓ [P2] noteget         指定行を読み込み
✓ [P2] noteload        対象バッファ読み込み
✓ [P2] notesave        対象バッファ保存
✓ [P2] noteunsel       対象バッファの復帰

✓ [P2] split           文字列から分割された要素を代入
✓ [P2] strrep          文字列の置換をする
✓ [P2] getstr          バッファから文字列読み出し

○ [P3] strexchange     スクリプト内の文字列を置き換える（プリプロセッサ的）
✓ [P3] cnvstoa         通常文字列をANSI文字列に変換
✓ [P3] cnvstow         通常文字列をunicodeに変換


■ 文字列操作関数 [P2]
----------------------------------------
✓ [P2] instr           文字列の検索をする
✓ [P2] strmid          文字列の一部を取り出す
✓ [P2] strtrim         指定した文字だけを取り除く
✓ [P2] strf            書式付き文字列を変換

✓ [P2] notefind        メモリノートパッド検索
✓ [P2] noteinfo        メモリノートパッド情報取得

✓ [P2] getpath         パスの一部を取得

✓ [P3] cnvatos         ANSI文字列を通常文字列に変換
✓ [P3] cnvwtos         unicodeを通常文字列に変換


================================
第4フェーズ: GUI部品
================================

■ オブジェクト制御命令 [P3]
----------------------------------------
✓ [P3] button          ボタン表示
✓ [P3] input           入力ボックス表示
✓ [P3] mesbox          メッセージボックス表示
✓ [P3] chkbox          チェックボックス表示
✓ [P3] combox          コンボボックス表示
✓ [P3] listbox         リストボックス表示

✓ [P3] objmode         オブジェクトモード設定
✓ [P3] objsize         オブジェクトサイズ設定
✓ [P3] objcolor        オブジェクトのカラー設定
✓ [P3] objprm          オブジェクトの内容を変更
✓ [P3] objsel          オブジェクトに入力フォーカスを設定
✓ [P3] objenable       オブジェクトの有効・無効を設定
✓ [P3] objskip         オブジェクトのフォーカス移動モードを設定
✓ [P3] clrobj          オブジェクトをクリア

× [--] objimage        カスタムボタンの設定（ビットマップボタン用）
× [--] layerobj        レイヤーオブジェクトを追加（HSP3Dish専用）


================================
第5フェーズ: マルチメディア
================================

■ マルチメディア制御命令 [P3]
----------------------------------------
✓ [P3] mmload          メディアファイル読み込み
✓ [P3] mmplay          メディア再生
✓ [P3] mmstop          メディア再生の停止
✓ [P3] mmvol           音量の設定
✓ [P3] mmpan           パンニングの設定
✓ [P3] mmstat          メディアの状態取得

× [--] mci             MCIにコマンドを送る（低レベルAPI）


================================
第6フェーズ: システム統合
================================

■ システム変数 [P2]
----------------------------------------
× [P2] cnt             ループのカウンター（ループ変数を使用）
× [P2] stat            色々な命令のステータス値（関数の戻り値を使用）
× [P2] refstr          色々な命令のステータス文字列（関数の戻り値を使用）
× [P2] refdval         色々な命令のステータス実数値
× [P2] strsize         読み出しバイト数（関数の戻り値を使用）

○ [P2] err             HSPのエラーコード
○ [P2] hspstat         HSPランタイムの情報
○ [P2] hspver          HSPのバージョン番号

× [P2] looplev         repeatのネストレベル
× [P2] sublev          サブルーチンのネストレベル

✓ [P2] hwnd            現在のウィンドウハンドル
△ [P2] hdc             現在のデバイスコンテキスト（D2D中心のため0固定）
✓ [P2] hinstance       現在のインスタンスハンドル

✓ [P3] dir_cur         カレントディレクトリ
✓ [P3] dir_exe         実行ファイルがあるディレクトリ
✓ [P3] dir_cmdline     コマンドライン文字列
✓ [P3] dir_win         Windowsディレクトリ
✓ [P3] dir_sys         Windowsシステムディレクトリ
✓ [P3] dir_desktop     デスクトップディレクトリ
✓ [P3] dir_mydoc       マイドキュメントディレクトリ

× [--] dir_tv          HSPTVディレクトリ（HSPTV専用）
× [--] thismod         現在の有効なモジュール変数（モジュール機能は別設計）

✓ [P3] notemax         メモリノートパッドの行数
✓ [P3] notesize        メモリノートパッドの文字数

× [--] ginfo_accel*    加速度センサー値（モバイル専用）
× [--] ginfo_gyro*     傾きセンサー値（モバイル専用）


■ HSPシステム制御命令 [P4]
----------------------------------------
× [P4] assert          デバッグウィンドウ表示（Visual Studio等のIDEデバッガを使用すべき）
✓ [P4] logmes          デバッグメッセージ送信
× [--] logmesv         変数デバッグメッセージ表示設定（IDE連携）
× [--] logmesva        配列変数デバッグメッセージ表示設定（IDE連携）
× [--] varprop         変数のデバッグ設定を行う（IDE連携）


================================
不要機能（ライブラリ方針外）
================================

■ プリプロセッサ命令 [--]
----------------------------------------
× すべてのプリプロセッサ命令
  理由: C++コンパイラのプリプロセッサを使用
  (#include, #define, #ifdef等のC++標準を使用)

■ DLL/COM関連 [--]
----------------------------------------
× #uselib, #func, #cfunc          外部DLL関連
× #usecom, #comfunc               COM関連
× mcall, callfunc, libptr         外部呼び出し関連
  理由: C++の標準的なDLL/COMアクセス手法を使用

■ モジュール機能（HSP独自仕様） [--]
----------------------------------------
× #module, #global, #modinit等
  理由: C++のクラス・名前空間を使用

■ 変数型宣言（HSP独自仕様） [--]
----------------------------------------  
× #var, #varint, #varstr等
  理由: C++の型システムを使用

■ 実行時パッキング [--]
----------------------------------------
× #pack, #epack, #packdir等
  理由: ビルドシステムで対応


================================
実装優先順位まとめ
================================

【最優先】第1フェーズ: 基幹構造の確立
- 画面初期化・描画・入力の基本機能
- ウィンドウ表示とイベントループ
→ ここまででGUI動作確認が可能

【高優先】第2フェーズ: 割り込み・イベント
- 割り込みハンドラの実装
- イベント駆動プログラミングの基盤
→ インタラクティブなアプリケーション作成が可能

【中優先】第3フェーズ: データ管理
- 配列・文字列・ファイル操作
- メモリ管理とバッファ操作
→ 実用的なアプリケーション開発が可能

【低優先】第4フェーズ: GUI部品
- ボタン・入力欄等のウィジェット
→ フォームベースのUI作成が可能

【低優先】第5フェーズ: マルチメディア
- 音声・動画再生
→ マルチメディアアプリケーション対応

【最終】第6フェーズ: システム統合
- システム変数・デバッグ機能
→ 完全なHSP互換環境の実現


================================
次のアクション
================================

1. ✓ 画面制御の未実装関数を完成
   - cls, font, title, width等

2. ✓ 割り込みハンドラの実装
   - onclick, oncmd, onerror等の実体

3. ✓ 基本的な数学関数・文字列関数
   - abs, sin, cos, strlen, instr等

4. ✓ ファイルI/O基盤
   - bload, bsave, exist等

5. × 配列・メモリ管理（C++標準を使用のため不要）
   - dim, sdim, ddim等 → std::vector/std::stringを使用

6. ✓ GUI部品
   - button, input, mesbox, chkbox, combox, listbox等
   - objsize, objmode, objcolor, objprm, objsel, objenable, objskip, clrobj

7. ✓ マルチメディア機能
   - mmload, mmplay, mmstop, mmvol, mmpan, mmstat
   - XAudio2 + Media Foundation ハイブリッド実装
   - WAVファイル: XAudio2で低レイテンシ再生
   - MP3/その他: Media Foundationで再生
   - 16スロット対応、HSP互換値範囲（Volume: -1000～0, Pan: -1000～1000）
